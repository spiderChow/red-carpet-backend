package cn.edu.fudan.yst;

import net.sf.json.JSONObject;

import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.HttpURLConnection;
import java.net.MalformedURLException;
import java.net.URL;

public class GetAddressByIp
{

    public static void main(String[] args) {
        String[] ips = new String[]{
                "98.248.145.88",
                "61.49.101.214",
                "61.167.223.16",
                "61.167.176.214",
                "61.158.149.92",
                "61.158.149.167",
                "61.158.148.57",
                "61.156.194.40",
                "61.144.111.93",
                "60.27.192.167",
                "60.255.43.180",
                "60.223.131.73",
                "60.223.102.201",
                "60.221.112.110",
                "60.220.73.42",
                "60.220.73.180",
                "60.218.70.178",
                "60.214.15.133",
                "60.212.27.7",
                "60.162.213.201",
                "59.63.206.211",
                "59.63.206.179",
                "59.55.162.252",
                "59.48.93.174",
                "59.41.95.199",
                "59.33.233.72",
                "59.175.183.114",
                "58.50.68.116",
                "58.33.104.110",
                "58.255.226.82",
                "58.249.14.198",
                "58.243.250.108",
                "58.218.177.76",
                "43.242.152.61",
                "42.89.95.70",
                "42.88.86.45",
                "42.88.48.147",
                "42.86.151.126",
                "42.55.2.239",
                "42.5.55.254",
                "42.245.253.163",
                "42.245.197.202",
                "42.245.196.44",
                "42.245.196.39",
                "42.245.196.32",
                "42.245.196.205",
                "42.238.113.119",
                "42.235.153.233",
                "42.233.184.176",
                "42.202.79.185",
                "42.184.189.68",
                "42.102.213.159",
                "42.101.254.195",
                "39.79.74.35",
                "39.76.18.52",
                "39.73.214.6",
                "39.68.149.173",
                "39.67.200.34",
                "39.189.57.251",
                "39.176.202.126",
                "39.168.152.163",
                "39.158.156.130",
                "36.98.221.192",
                "36.98.206.163",
                "36.98.152.120",
                "36.60.26.229",
                "36.60.128.223",
                "36.57.129.186",
                "36.157.243.38",
                "36.157.232.14",
                "36.157.191.30",
                "36.149.77.209",
                "27.38.254.191",
                "27.227.122.24",
                "27.222.202.193",
                "27.201.34.29",
                "27.201.121.79",
                "27.200.237.78",
                "27.198.240.5",
                "27.190.14.42",
                "27.186.194.180",
                "27.156.177.70",
                "223.99.199.249",
                "223.99.12.18",
                "223.96.97.76",
                "223.96.247.117",
                "223.96.156.171",
                "223.91.29.80",
                "223.91.228.158",
                "223.91.212.194",
                "223.91.200.240",
                "223.91.1.65",
                "223.90.119.55",
                "223.90.116.196",
                "223.89.72.145",
                "223.89.36.144",
                "223.89.14.12",
                "223.8.184.250",
                "223.74.200.172",
                "223.73.137.134",
                "223.72.86.33",
                "223.72.54.58",
                "223.247.250.214",
                "223.152.28.167",
                "223.11.231.5",
                "223.11.102.75",
                "223.104.64.70",
                "223.104.63.93",
                "223.104.63.248",
                "223.104.25.244",
                "223.104.248.5",
                "223.104.24.103",
                "223.104.227.22",
                "223.104.217.84",
                "223.104.215.13",
                "223.104.213.89",
                "223.104.210.152",
                "223.104.2.51",
                "223.104.19.250",
                "223.104.186.23",
                "223.104.185.186",
                "223.104.175.89",
                "223.104.17.217",
                "223.104.169.83",
                "223.104.146.103",
                "223.104.14.94",
                "223.104.13.61",
                "223.104.108.243",
                "223.104.108.134",
                "223.104.101.182",
                "223.104.101.135",
                "223.101.128.89",
                "223.101.118.169",
                "222.84.30.155",
                "222.68.36.244",
                "222.39.154.23",
                "222.38.151.204",
                "222.38.151.194",
                "222.37.51.231",
                "222.218.1.39",
                "222.169.73.228",
                "222.169.39.6",
                "222.169.39.170",
                "222.169.170.105",
                "222.163.122.97",
                "222.139.2.2",
                "222.136.81.17",
                "222.134.227.153",
                "221.219.110.125",
                "221.212.233.105",
                "221.207.204.65",
                "220.195.65.176",
                "220.194.107.221",
                "220.176.154.13",
                "220.161.201.126",
                "218.9.176.148",
                "218.72.111.170",
                "218.67.167.113",
                "218.66.33.183",
                "218.26.55.59",
                "218.26.54.60",
                "218.26.54.44",
                "211.142.219.77",
                "210.31.76.63",
                "183.40.38.241",
                "183.40.161.170",
                "183.253.134.6",
                "183.240.19.241",
                "183.232.227.61",
                "183.226.28.16",
                "183.226.136.100",
                "183.223.129.230",
                "183.214.21.20",
                "183.211.41.210",
                "183.208.165.250",
                "183.202.86.137",
                "183.202.84.127",
                "183.202.78.198",
                "183.202.55.198",
                "183.202.246.3",
                "183.202.240.160",
                "183.202.229.118",
                "183.202.217.205",
                "183.202.214.100",
                "183.202.213.112",
                "183.202.188.173",
                "183.202.177.49",
                "183.202.175.60",
                "183.202.140.180",
                "183.200.54.150",
                "183.200.46.76",
                "183.200.45.92",
                "183.199.189.99",
                "183.199.176.35",
                "183.199.160.6",
                "183.199.144.87",
                "183.198.63.252",
                "183.198.250.141",
                "183.198.222.108",
                "183.198.214.37",
                "183.198.2.217",
                "183.198.17.147",
                "183.197.94.35",
                "183.197.239.237",
                "183.197.160.165",
                "183.186.69.3",
                "183.186.53.235",
                "183.186.233.83",
                "183.186.232.181",
                "183.186.188.61",
                "183.160.241.116",
                "183.139.131.241",
                "183.131.116.76",
                "182.91.123.236",
                "182.87.94.94",
                "182.32.8.155",
                "182.109.67.171",
                "180.97.201.6",
                "180.213.50.29",
                "180.160.159.63",
                "180.126.155.54",
                "180.107.35.123",
                "175.42.161.68",
                "175.171.145.230",
                "175.162.67.155",
                "171.215.7.121",
                "171.210.177.66",
                "171.13.212.165",
                "171.125.185.163",
                "171.122.47.113",
                "171.121.62.56",
                "171.121.109.34",
                "171.121.106.200",
                "171.120.58.88",
                "171.119.45.170",
                "171.119.43.237",
                "171.118.181.164",
                "171.117.238.238",
                "171.116.132.38",
                "171.114.50.243",
                "171.111.100.213",
                "171.11.231.143",
                "171.109.167.25",
                "171.106.33.150",
                "171.10.38.89",
                "171.10.198.113",
                "157.61.160.62",
                "140.243.43.21",
                "14.146.94.119",
                "14.106.162.180",
                "139.226.104.17",
                "139.214.144.60",
                "139.213.156.193",
                "139.211.207.75",
                "139.207.65.118",
                "125.70.204.126",
                "125.211.42.24",
                "125.121.57.107",
                "124.72.222.236",
                "124.239.99.183",
                "124.238.117.3",
                "124.237.47.189",
                "124.231.143.39",
                "124.166.59.180",
                "124.166.248.139",
                "124.165.185.112",
                "124.164.119.196",
                "123.184.53.80",
                "123.181.27.54",
                "123.178.87.62",
                "123.170.184.89",
                "123.170.165.138",
                "123.170.150.206",
                "123.160.44.220",
                "123.151.76.158",
                "123.147.250.101",
                "123.147.244.48",
                "123.139.205.135",
                "123.129.58.243",
                "123.129.37.19",
                "122.70.145.61",
                "122.70.129.146",
                "122.7.19.70",
                "122.192.15.167",
                "122.156.84.248",
                "122.156.165.16",
                "122.140.195.11",
                "121.30.200.66",
                "121.234.4.110",
                "121.19.26.224",
                "121.16.9.16",
                "121.16.172.173",
                "121.14.14.22",
                "120.95.72.18",
                "120.9.196.215",
                "120.8.25.86",
                "120.42.139.247",
                "120.41.162.200",
                "120.3.15.157",
                "120.239.219.43",
                "120.239.218.202",
                "120.239.136.237",
                "120.230.166.238",
                "120.229.107.253",
                "120.210.190.177",
                "120.210.177.248",
                "120.193.228.68",
                "120.193.204.230",
                "120.193.204.132",
                "120.192.33.157",
                "120.192.230.45",
                "120.192.2.104",
                "120.15.216.247",
                "120.14.139.128",
                "120.10.207.140",
                "119.86.119.215",
                "119.51.218.14",
                "119.188.101.173",
                "119.187.236.115",
                "119.186.222.172",
                "119.185.162.138",
                "119.183.244.116",
                "119.181.121.17",
                "119.176.201.72",
                "119.141.247.120",
                "119.109.235.28",
                "119.109.182.242",
                "118.78.58.98",
                "118.77.231.222",
                "118.77.205.155",
                "118.74.51.231",
                "118.74.224.189",
                "118.73.58.47",
                "118.73.187.37",
                "118.73.128.45",
                "118.249.59.163",
                "118.212.209.214",
                "118.212.207.78",
                "118.212.190.185",
                "118.183.124.82",
                "118.144.32.39",
                "117.91.23.229",
                "117.61.2.111",
                "117.187.41.125",
                "117.181.56.3",
                "117.179.68.25",
                "117.179.31.106",
                "117.179.212.233",
                "117.179.183.211",
                "117.179.145.171",
                "117.179.138.249",
                "117.163.192.122",
                "117.157.56.177",
                "117.136.94.240",
                "117.136.94.214",
                "117.136.90.100",
                "117.136.86.40",
                "117.136.79.78",
                "117.136.79.47",
                "117.136.79.248",
                "117.136.77.47",
                "117.136.74.163",
                "117.136.72.48",
                "117.136.71.165",
                "117.136.71.151",
                "117.136.70.143",
                "117.136.7.67",
                "117.136.7.255",
                "117.136.66.95",
                "117.136.66.243",
                "117.136.64.104",
                "117.136.63.143",
                "117.136.62.144",
                "117.136.60.251",
                "117.136.50.213",
                "117.136.50.199",
                "117.136.50.142",
                "117.136.49.35",
                "117.136.47.137",
                "117.136.40.18",
                "117.136.4.235",
                "117.136.4.162",
                "117.136.4.128",
                "117.136.39.231",
                "117.136.39.118",
                "117.136.32.110",
                "117.136.13.207",
                "117.136.12.122",
                "117.136.109.137",
                "117.136.100.55",
                "117.135.227.147",
                "117.135.223.29",
                "116.27.45.49",
                "116.252.204.44",
                "116.249.15.158",
                "116.17.100.99",
                "116.116.186.15",
                "116.116.106.198",
                "116.114.175.248",
                "115.62.57.86",
                "115.61.86.163",
                "115.51.238.251",
                "115.27.219.249",
                "113.88.199.94",
                "113.85.196.50",
                "113.84.196.131",
                "113.83.240.144",
                "113.81.163.49",
                "113.56.95.57",
                "113.5.6.220",
                "113.5.6.111",
                "113.4.130.202",
                "113.3.117.199",
                "113.26.6.186",
                "113.26.57.56",
                "113.26.39.76",
                "113.26.39.235",
                "113.26.255.252",
                "113.26.154.239",
                "113.26.13.207",
                "113.26.125.55",
                "113.25.211.30",
                "113.239.172.178",
                "113.222.174.173",
                "113.15.218.226",
                "113.129.98.79",
                "113.129.92.71",
                "113.129.74.201",
                "113.128.92.43",
                "113.127.155.88",
                "113.121.131.220",
                "112.98.229.28",
                "112.98.185.177",
                "112.97.53.125",
                "112.97.51.15",
                "112.96.66.70",
                "112.96.170.226",
                "112.8.218.218",
                "112.8.208.210",
                "112.6.113.121",
                "112.41.54.193",
                "112.40.194.4",
                "112.38.196.5",
                "112.36.87.183",
                "112.36.50.111",
                "112.28.148.56",
                "112.26.78.145",
                "112.252.72.84",
                "112.227.178.216",
                "112.224.23.178",
                "112.224.23.172",
                "112.21.78.11",
                "112.2.254.7",
                "112.192.249.6",
                "112.17.246.235",
                "112.17.240.240",
                "112.12.142.77",
                "111.58.196.131",
                "111.53.240.22",
                "111.52.123.129",
                "111.41.253.170",
                "111.41.115.231",
                "111.41.109.249",
                "111.4.196.175",
                "111.35.49.209",
                "111.34.104.85",
                "111.30.229.110",
                "111.29.133.57",
                "111.27.99.128",
                "111.27.71.65",
                "111.26.35.241",
                "111.26.33.36",
                "111.26.30.132",
                "111.227.51.51",
                "111.226.92.201",
                "111.226.90.196",
                "111.196.61.156",
                "111.19.53.17",
                "111.17.132.50",
                "111.16.135.49",
                "111.112.159.34",
                "111.1.110.61",
                "110.53.253.66",
                "110.52.156.86",
                "110.255.55.186",
                "110.253.46.216",
                "110.250.34.171",
                "110.245.234.90",
                "110.231.101.27",
                "110.19.107.61",
                "110.187.62.14",
                "110.182.3.46",
                "110.182.123.170",
                "110.180.18.146",
                "106.6.181.27",
                "106.57.72.227",
                "106.40.127.226",
                "106.34.149.132",
                "106.117.69.89",
                "106.115.14.199",
                "106.114.69.71",
                "103.251.99.145",
                "101.94.97.52",
                "101.94.96.199",
                "101.94.134.187",
                "101.94.132.251",
                "101.94.131.52",
                "101.94.131.117",
                "101.94.128.240",
                "101.90.127.4",
                "101.22.112.105",
                "101.20.201.253",
                "101.17.7.234",
                "101.17.153.227",
                "10.222.97.211",
                "10.222.75.16",
                "10.222.212.105",
                "10.222.179.45",
                "10.222.169.59",
                "10.222.169.46",
                "10.222.102.237",
                "10.221.175.251",
                "10.221.150.34",
                "10.187.109.117",
                "1.81.129.18",
                "1.69.84.57",
                "1.69.55.43",
                "1.69.34.255",
                "1.68.46.202",
                "1.63.199.53",
                "1.62.165.48",
                "1.60.112.239",
                "1.58.131.99",
                "1.48.74.212",
                "1.31.3.71",
                "1.26.125.68",
                "1.195.181.143",
                "1.194.10.122",
                "1.192.25.247",
                "1.188.221.72",
                "1.182.103.19"
        };
        for (String ip : ips){
            String getAddressByIp = GetAddressByIp(ip);
            System.out.println(getAddressByIp);

        }

    }
    /**
     *
     * @param IP
     * @return
     */
    public static String GetAddressByIp(String IP){
        String resout = "";
        try{
            String str = getJsonContent("http://ip.taobao.com/service/getIpInfo.php?ip="+IP);
            //http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=js&ip=
            //http://ip.taobao.com/service/getIpInfo.php?ip=

            System.out.println(str);

            JSONObject obj = JSONObject.fromObject(str);
            JSONObject obj2 =  (JSONObject) obj.get("data");
            String code = String.valueOf(obj.get("code"));
            if(code.equals("0")){

                resout =  obj2.get("country")+"--" +obj2.get("area")+"--" +obj2.get("city")+"--" +obj2.get("isp");
            }else{
                resout =  "IP地址有误";
            }
        }catch(Exception e){

            e.printStackTrace();
            resout = "获取IP地址异常："+e.getMessage();
        }
        return resout;

    }

    public static String getJsonContent(String urlStr)
    {
        try
        {// 获取HttpURLConnection连接对象
            URL url = new URL(urlStr);
            HttpURLConnection httpConn = (HttpURLConnection) url
                    .openConnection();
            // 设置连接属性
            httpConn.setConnectTimeout(3000);
            httpConn.setDoInput(true);
            httpConn.setRequestMethod("GET");
            // 获取相应码
            int respCode = httpConn.getResponseCode();
            if (respCode == 200)
            {
                return ConvertStream2Json(httpConn.getInputStream());
            }
        }
        catch (MalformedURLException e)
        {
            e.printStackTrace();
        }
        catch (IOException e)
        {
            e.printStackTrace();
        }
        return "";
    }


    private static String ConvertStream2Json(InputStream inputStream)
    {
        String jsonStr = "";
        // ByteArrayOutputStream相当于内存输出流
        ByteArrayOutputStream out = new ByteArrayOutputStream();
        byte[] buffer = new byte[1024];
        int len = 0;
        // 将输入流转移到内存输出流中
        try
        {
            while ((len = inputStream.read(buffer, 0, buffer.length)) != -1)
            {
                out.write(buffer, 0, len);
            }
            // 将内存流转换为字符串
            jsonStr = new String(out.toByteArray());
        }
        catch (IOException e)
        {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }
        return jsonStr;
    }
}